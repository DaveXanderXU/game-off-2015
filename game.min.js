/**
 * Strider
 * Github Game-Off 2015 Entry
 * by Petar Petrov / github.com/petarov
 *
 * (A fork of) Octocat Jump
 * A Github Game Off 2012 Entry
 * @copyright Omer Goshen <gershon@goosemoose.com>
 */!function(a){window.addEventListener("keydown",function(a){switch(a.keyCode){case 37:case 39:case 38:case 40:case 32:a.preventDefault()}},!1)}(Crafty),function(a){document.addEventListener("DOMContentLoaded",function(){var b=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),c=400,d=640,e=document.getElementById("game"),f=!1;a.init(c,d,e),a.viewport.init(c,d,e),a.viewport.bounds={min:{x:-100,y:-(1/0)},max:{x:c+50,y:d}},a.settings.modify("autoPause",!0),a.c("SpaceFont",{init:function(){this.requires("2D, DOM, Text"),this.textFont({family:"Jura",size:"11px",weight:"normal"}),this.textColor("white"),this.css({textShadow:"0px 2px 4px rgba(0,0,0,.5)"})}}),a.scene("loading",function(){a.background("#005564");var c=a.e("2D, DOM, Text, SpaceFont").attr({x:85,y:150,w:a.viewport.width}).textFont({size:"20px"}).textColor("white").text("Establishing secure com..."),d=a.e("2D, DOM, Text, SpaceFont").attr({x:180,y:180,w:150}).textFont({size:"20px"}).textColor("white").text("0%"),e=a.e("2D, Canvas, Color, Tween, Delay").attr({x:0,y:0,z:-1,w:a.viewport.width,h:a.viewport.height,alpha:0}).color("white");a.paths({audio:"assets/sfx/",images:"assets/images/"});var g={images:["splash_screen.jpg","splash_screen_blurred.jpg","cratfy_logo.png","gameoff.jpg","wall01.png","backgrounds.png","starsky.png","audioOn.png","audioOff.png","musicOn.png","musicOff.png"],sprites:{"ui_energy.png":{tile:72,tileh:19,map:{HUDEnergy:[0,0]}},"ui_health.png":{tile:69,tileh:19,map:{HUDHealth4:[0,0],HUDHealth3:[0,1],HUDHealth2:[0,2],HUDHealth1:[0,3],HUDHealth0:[0,4]}},"smoke_jump.png":{tile:64,tileh:64,map:{SmokeJump:[0,0]}},"platform.png":{tile:50,tileh:26,map:{PlatformBlue:[0,0],PlatformGreen:[1,0]}},"platform_big.png":{tile:150,tileh:26,map:{PlatformBlueBig:[0,0],PlatformGreenBig:[0,1]}},"door_anim.png":{tile:50,tileh:54,paddingX:3,paddingY:0,map:{DoorAnim:[0,0]}},"gunner.png":{tile:50,tileh:57,map:{Gunner:[0,0]}},"spikes.png":{tile:50,tileh:23,map:{Spikes01:[0,0],Spikes02:[1,0]}},"bloodanim.png":{tile:76,tileh:45,map:{Splatter:[0,0]}},"spaceship.png":{tile:88,tileh:86,map:{Spaceship:[0,0]}},"spaceship_engine.png":{tile:18,tileh:18,map:{SpaceshipEngine:[0,0]}},"flares.png":{tile:18,tileh:17,map:{Flares:[0,0]}},"powerups.png":{tile:19,tileh:19,map:{HealthRed:[0,1],HealthGray:[1,1],EnergyOrange:[0,0],EnergyBlue:[3,0]}},"enemy_turret.png":{tile:50,tileh:26,map:{EnemyTurretGreen:[0,0],EnemyTurretRed:[0,1],EnemyTurretPurple:[0,2]}},"enemy_bullet.png":{tile:10,tileh:10,map:{EnemyBullet:[0,0],EnemyBulletBlue:[0,1],EnemyBulletGlow:[0,2]}},"enemy_drone.png":{tile:50,tileh:50,paddingX:1,paddingY:1,map:{EnemyDrone:[0,0],EnemyDroneAdvanced:[2,0],EnemyDroneDestroyer:[0,1],EnemyDrone2:[2,1]}},"xhair.png":{tile:46,tileh:46,map:{Xhair:[0,0]}},"explo01.png":{tile:34,tileh:30,map:{ExplosionsYB:[0,0]}},"explo02.png":{tile:33,tileh:31,map:{ExplosionHit:[0,0]}}},audio:{jump:["land.ogg","land.m4a"],jumpboost:["jumpboost.ogg","jumpboost.m4a"],land:["landfeet.ogg","landfeet.m4a"],hurt:["hurt.ogg","hurt.m4a"],death:["death.ogg","death.m4a"],deathsplat:["deathsplat.ogg","deathsplat.m4a"],turretshot1:["turretshot.ogg","turretshot.m4a"],turretshot2:["turretshot2.ogg","turretshot2.m4a"],explode1:["explode.ogg","explode.m4a"],explode2:["explode2.ogg","explode2.m4a"],droneshot1:["droneshot.ogg","droneshot.m4a"],droneshot2:["droneshot2.ogg","droneshot2.m4a"],gun1:["gun01.ogg","gun01.m4a"],gun2:["gun02.ogg","gun02.m4a"],gun3:["gun03.ogg","gun03.m4a"],gunclip:["gunclip.ogg","gunclip.m4a"],rico1:["rico01.ogg","rico01.m4a"],rico2:["rico02.ogg","rico02.m4a"],rico3:["rico03.ogg","rico03.m4a"],warning:["warning.ogg","warning.m4a"],doorshut:["doorshut.ogg","doorshut.m4a"],powerup01:["pup01.ogg","pup01.m4a"],powerup02:["pup02.ogg","pup02.m4a"],overcharge:["overcharge.ogg","overcharge.m4a"],movin:["movin.ogg","movin.m4a"],liftoff:["liftoff.ogg","liftoff.m4a"],liftoff2:["liftoff2.ogg","liftoff2.m4a"],wait4mom:["wait4urmom.ogg","wait4urmom.m4a"],menu:["menu.ogg","menu.m4a"],menu2:["menu2.ogg","menu2.m4a"],music1:["2ndtlegion.ogg"]}};b&&(console.log(b),g.audio={},document.getElementsByClassName("sorry")[0].style.visibility="visible"),a.load(g,function(){f&&a.scene("menu"),e.tween({alpha:1},1800).bind("TweenEnd",function(){a.scene("intro")}).delay(function(){c.visible=!1,d.visible=!1},1e3)},function(a){d.text(~~a.percent+"%")},function(a){console.log("ya blew it!"),console.error(a)})})})}(Crafty),function(a){document.addEventListener("DOMContentLoaded",function(){var b=250,c=2e3;a.scene("intro",function(){a.background("#f6fafb");a.e("2D, DOM, Text, SpaceFont, Delay").attr({x:145,y:a.viewport.height-16,w:a.viewport.width,alpha:1}).textFont({size:"12px"}).textColor("#888").text("Press ESC to skip intro");a.e("Keyboard").bind("KeyDown",function(b){b.keyCode===a.keys.ESC&&(this.destroy(),a.scene("menu"))}),a.e("2D, Canvas, Image, Tween, Delay").attr({x:0,y:95,alpha:0}).image("assets/images/gameoff.jpg").tween({alpha:1},b).one("TweenEnd",function(){this.unbind("TweenEnd"),this.delay(function(){this.tween({alpha:0},b).bind("TweenEnd",function(){this.unbind("TweenEnd");a.e("2D, Canvas, Image, Tween, Delay").attr({x:126.5,y:260,alpha:0}).image("assets/images/cratfy_logo.png").tween({alpha:1},b).bind("TweenEnd",function(){this.unbind("TweenEnd"),this.delay(function(){this.tween({alpha:0},b).bind("TweenEnd",function(){a.scene("menu")})},c)})})},c)})}),a.scene("menu",function(){a.background("#f6fafb"),a.viewport.x=0,a.viewport.y=0,a.audio.stop(),a.e("2D, Canvas, Image, Tween, Keyboard").attr({alpha:0}).image("assets/images/splash_screen.jpg").tween({alpha:1},b).bind("TweenEnd",function(){var b=180,c=a.viewport.height-115;a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c,w:a.viewport.width}).textFont({size:"14px"}).textColor("white").text("Play"),a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c+25,w:a.viewport.width}).textFont({size:"14px"}).textColor("white").text("Instructions"),a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c+50,w:a.viewport.width}).textFont({size:"14px"}).textColor("white").text("Credits"),a.e("2D, DOM, Text, SpaceFont").attr({x:2,y:a.viewport.height-12,w:a.viewport.width}).textFont({size:"10px"}).textColor("white").text("1.0.2");var d=a.e("2D, Canvas, Color, Tween").attr({x:b-15,y:c-1,w:230,h:16,pos:0,alpha:.35}).color("white").bind("Sel",function(a){"up"===a?this.pos-=1:"down"===a&&(this.pos+=1),this.pos<0?this.pos=2:this.pos>2&&(this.pos=0),this.alpha=.9,this.tween({alpha:.35},500),this.y=c-1+25*this.pos});this.bind("KeyUp",function(b){if(b.keyCode===a.keys.UP_ARROW?(d.trigger("Sel","up"),a.audio.play("menu")):b.keyCode===a.keys.DOWN_ARROW&&(d.trigger("Sel","down"),a.audio.play("menu")),b.keyCode===a.keys.X||b.keyCode===a.keys.ENTER||b.keyCode===a.keys.SPACE)switch(this.destroy(),d.pos){case 0:return void a.scene("main");case 1:return a.audio.play("menu2"),void a.scene("instructions");case 2:return a.audio.play("menu2"),void a.scene("credits")}})})}),a.scene("instructions",function(){a.background("url('assets/images/splash_screen_blurred.jpg')"),a.viewport.x=0,a.viewport.y=0;var b=15,c=25,d="white";a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c,w:a.viewport.width}).textFont({size:"16px"}).textColor("#888").text("Goal"),a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c+25,w:a.viewport.width-75}).textFont({size:"14px"}).textColor(d).text("You are Strider. An agent of a rebel force that needs to deliver some very important intel to HQ. You've got the data and now you need to make your escape. A 3 km. deep shaft stands between you and a transport ship waiting to pick you up at 0 m. height. Jump up on the platforms, destroy the defense systems and deliver that intel."),c+=140,a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c,w:a.viewport.width}).textFont({size:"16px"}).textColor("#888").text("Controls"),a.e("2D, Canvas, Powerup, Gunner").attr({x:b-10,y:c+60}),a.e("2D, DOM, Text, SpaceFont").attr({x:b+50,y:c+25,w:a.viewport.width-50}).textFont({size:"14px"}).textColor(d).text("Use the arrow or 'WAsD' keys to move and jump."),a.e("2D, DOM, Text, SpaceFont").attr({x:b+50,y:c+50,w:a.viewport.width-75}).textFont({size:"14px"}).textColor(d).text("Press 'Up' or 'W' twice to activate your thrusters and do a double jump."),a.e("2D, DOM, Text, SpaceFont").attr({x:b+50,y:c+90,w:a.viewport.width-75}).textFont({size:"14px"}).textColor(d).text("Press either 'X', 'Z' or 'Y' to shoot. You don't need to aim. Your rifle targets the nearest enemy automatically."),a.e("2D, DOM, Text, SpaceFont").attr({x:b+50,y:c+140,w:a.viewport.width-75}).textFont({size:"14px"}).textColor(d).text("Your rifle needs energy to shoot. You need to either pick up powerups or wait until it recharges."),c+=180,a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c,w:a.viewport.width}).textFont({size:"16px"}).textColor("#888").text("Powerups"),a.e("2D, Canvas, Powerup, HealthRed").attr({x:b,y:c+25}),a.e("2D, DOM, Text, SpaceFont").attr({x:b+30,y:c+30,w:a.viewport.width}).textFont({size:"14px"}).textColor(d).text("+1 HP"),a.e("2D, Canvas, Powerup, EnergyOrange").attr({x:b,y:c+50}),a.e("2D, DOM, Text, SpaceFont").attr({x:b+30,y:c+55,w:a.viewport.width}).textFont({size:"14px"}).textColor(d).text("30% percent energy refill."),a.e("2D, Canvas, Powerup, EnergyBlue").attr({x:b,y:c+75}),a.e("2D, DOM, Text, SpaceFont").attr({x:b+30,y:c+80,w:a.viewport.width}).textFont({size:"14px"}).textColor(d).text("60% percent energy refill."),c+=135,a.e("2D, DOM, Text, SpaceFont").attr({x:b,y:c,w:a.viewport.width}).textFont({size:"16px"}).textColor("#888").text("Enemies"),a.e("2D, Canvas, Powerup, EnemyTurretGreen").attr({x:b,y:c+30}),a.e("2D, DOM, Text, SpaceFont").attr({x:b+70,y:c+40,w:a.viewport.width-70}).textFont({size:"14px"}).textColor(d).text("Non-moveable enemy turret."),a.e("2D, Canvas, Powerup, EnemyDrone").attr({x:b,y:c+80}),a.e("2D, DOM, Text, SpaceFont").attr({x:b+70,y:c+100,w:a.viewport.width-70}).textFont({size:"14px"}).textColor(d).text("Moveable enemy drone."),a.e("2D, DOM, Text, SpaceFont").attr({x:130,y:a.viewport.height-25,w:a.viewport.width}).textFont({size:"14px"}).textColor("white").text("Press any key to continue"),a.e("Keyboard").bind("KeyUp",function(b){this.destroy(),a.scene("menu")})}),a.scene("dead",function(b){b=b||{},b.meters=b.meters||0,a.audio.stop(),a("Delay").each(function(){this.destroy()}),a.unbind("Pause"),a.unbind("Unpause"),a.background("#000"),a.viewport.x=0,a.viewport.y=0,a.background("url('assets/images/starsky.png') repeat"),b.success?a.e("2D, DOM, Text, SpaceFont").attr({x:105,y:150,w:a.viewport.width}).textFont({size:"20px"}).text("Mission Successful!"):(a.e("2D, DOM, Text, SpaceFont").attr({x:135,y:150,w:a.viewport.width}).textFont({size:"20px"}).text("Mission Failed!"),a.e("2D, DOM, Text, SpaceFont").attr({x:100,y:250,w:250}).textFont({size:"20px"}).text("Strider reached: "+b.meters+" m.")),a.e("2D, DOM, Text, SpaceFont").attr({x:100,y:320,w:250}).textFont({size:"20px"}).text("Turrets destroyed: "+b.kills.turrets),a.e("2D, DOM, Text, SpaceFont").attr({x:100,y:350,w:250}).textFont({size:"20px"}).text("Drones destroyed: "+b.kills.drones),a.e("2D, DOM, Text, SpaceFont").attr({x:135,y:a.viewport.height-16,w:a.viewport.width}).text("Press any key to continue"),a.e("Keyboard").bind("KeyDown",function(b){this.destroy(),a.audio.stop("music1"),a.scene("menu")})}),a.scene("credits",function(b){a.background("#000"),a.viewport.x=0,a.viewport.y=0,a.background("url('assets/images/starsky.png') repeat");var c=50,d=120;a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d,w:a.viewport.width}).textFont({size:"20px"}).text("Producing & Programming"),a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d+30,w:a.viewport.width}).textFont({size:"20px"}).text("Petar Petrov"),d+=100,a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d,w:a.viewport.width}).textFont({size:"20px"}).text("Sprites & Animations"),a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d+30,w:a.viewport.width}).textFont({size:"20px"}).text("Master484 (m484games.ucoz.com)"),d+=100,a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d,w:a.viewport.width}).textFont({size:"20px"}).text("Artwork"),a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d+30,w:a.viewport.width}).textFont({size:"20px"}).text("Stretuz (stremena.com)"),d+=100,a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d,w:a.viewport.width}).textFont({size:"20px"}).text("Music"),a.e("2D, DOM, Text, SpaceFont").attr({x:c,y:d+30,w:a.viewport.width}).textFont({size:"20px"}).text("Petar Petrov"),a.e("2D, DOM, Text, SpaceFont").attr({x:135,y:a.viewport.height-16,w:a.viewport.width}).text("Press any key to continue"),a.e("Keyboard").bind("KeyDown",function(b){this.destroy(),a.scene("menu")})})})}(Crafty),function(a){document.addEventListener("DOMContentLoaded",function(){function b(){o&&console.log(arguments.length>1?arguments:arguments[0])}function c(a,b){for(var c,d,e=0,f=2*Math.PI/b,g=[],h=0;b>h;h++)c=Math.cos(e)*a,d=Math.sin(e)*a,g.push([c,d]),e+=f;return g}function d(a,b,c){for(var d=[],e=0;e<c.length;e++)d.push([c[e][0]+a,c[e][1]+b]);return d}function e(b,c,d){q&&a.audio.play(b,c,d)}function f(c,d,e){r&&(b("play music",c),a.audio.play(c,d===!0?-1:0,e))}function g(b){return u-~~(.1*(a.viewport.height-b)-1)}function h(){var b,c=[];c.push({x:a.viewport.width/2-50,y:a.viewport.height-60,w:50,h:26,num:0,clr:Math.random()>.5?"PlatformBlue":"PlatformGreen"});for(var d=a.viewport.width,e=-a.viewport.y+a.viewport.height-150,f=1;y>f;)b={x:-100+~~(Math.random()*d),y:e-100*f+50*Math.random(),hasDrone:!1,hasTurret:!1,powerup:!1},f%8==0&&f>8?(b.w=150,b.h=26,b.clr=Math.random()>.5?"PlatformBlueBig":"PlatformGreenBig",b.powerup=Math.random()>.3?C:D,b.hasDrone=!0):f%5===0?(b.w=150,b.h=26,b.clr=Math.random()>.5?"PlatformBlueBig":"PlatformGreenBig",b.powerup=Math.random()>.5?C:D,b.hasTurret=!0):(b.w=50,b.h=26,b.clr=Math.random()>.5?"PlatformBlue":"PlatformGreen",b.powerup=Math.random()<.2?Math.random()>.5?C:D:!1),b.num=f,c.push(b),f+=1;return c.push({x:a.viewport.width/2-75,y:e-100*f+50*Math.random(),w:150,h:26,num:f,clr:"PlatformBlueBig",goal:!0,hasDrone:!0}),c}function i(){a.background("none"),s=.8,fa=!1,ba=G,ca=F,x=u,Z=0,Y=[],I=[],enemies_data=[],bullets_data=[],ea.drones=0,ea.turrets=0,R=null,U=null,V=null,X=h(),a.unbind("EnterFrame"),a.unbind("Pause"),a.unbind("Unpause"),a.unbind("ViewportScroll")}function j(b){a.trigger("playerdead")}function k(b){a.trigger("playerwin")}function l(b){if(b[0]&&b[0].obj&&b[0].obj.visible){var c=b[0].obj;c.visible=!1,ba+=1,a.audio.isPlaying("powerup02")||(e("powerup02"),a.trigger("flashscreen",{clr:"#20ee20",delay:175})),a.trigger("playerupdatehealth"),a.trigger("playsmokeanim")}}function m(c){var d=c[0].obj;d&&d.visible&&(d.trigger("Kill"),ca+=d.energyType===E?~~(.6*F):~~(.3*F),b("*** TAKE ENERGY"),a.audio.isPlaying("powerup01")||(e("powerup01"),a.trigger("flashscreen",{clr:"#2020ee",delay:175})),a.trigger("playerupdatejuice"),a.trigger("playsmokeanim"))}function n(b){ba-=1,0>ba?(a.trigger("playerupdatehealth"),a("BackgroundOverlay").color("#ff0000"),a.trigger("playerdead")):(a.trigger("playerupdatehealth"),a.trigger("flashscreen",{clr:"#ff0000",delay:400}),e("hurt"))}var o=!1,p=1,q=!0,r=!0,s=.8,t=!o,u=3e3,v=.6*u,w=.3*u,x=u,y=u/10-1,z=y/2,A=y/2,B=2*A,C=1,D=2,E=3,F=49,G=4,H=15,I=[],J=450,K=450,L=1,M=2,N=3,O=4,P=5,Q=6,R=null,S=null,T=null,U=null,V=null,W=null,X=[],Y=[],Z=0,$=1500,_=4,aa=18,ba=4,ca=F,da=1,ea={},fa=!1,ga=44100,ha=1,ia=2,ja=3,ka=4,la=5,ma=6,na=2e3,oa=176400,pa=10,qa=1,ra=2,sa=~~(.9*oa);BULLET_SPEED=2.75,enemies_data=[],bullets_data=[],SPREAD8=c(10,8),SPREAD8_R=c(50,8);var ta=Math.PI,ua=Math.PI/6,va=(Math.PI/4,Math.PI/3),wa=(Math.PI/2,2*Math.PI/3),xa=(3*Math.PI/4,5*Math.PI/6);a.scene("main",function(){function c(b){w>x?Ea.y=-a.viewport.y:v>x?Da.y=-a.viewport.y:Ca.y=-a.viewport.y,Fa.y=-a.viewport.y}function h(a,b,c){for(var d=0;d<Y.length;d++)if(!Y[d].visible){Y[d].x=b,Y[d].y=c-19,Y[d].energyType=a,Y[d].removeComponent("EnergyOrange"),Y[d].removeComponent("EnergyBlue"),Y[d].removeComponent("HealthRed");var e;switch(a){case D:e="HealthRed";break;case C:e="EnergyOrange";break;case E:e="EnergyBlue";break;default:throw"Invalid powerup type "+a}return Y[d].addComponent(e),Y[d].visible=!0,Y[d].bind("Kill",function(){this.x=-500,this.visible=!1}),Y[d]}}function y(c,f,g){var h,i,j=!1,k=pa,l=na,m=oa,n=null;switch(c){case ha:h="EnemyTurretGreen",n=h;break;case ia:c=ha,h="EnemyTurretRed",n=h,k=~~(1.35*k),l=~~(.9*l);break;case ja:c=ha,h="EnemyTurretPurple",n=h,k=~~(1.5*k),l=~~(.8*l),m+=~~(.1*m);break;case ka:h="EnemyDrone",i=.025,n=h;break;case la:c=ka,h="EnemyDroneAdvanced",i=.05,k*=1.75,l=~~(.8*l),m+=~~(.15*m),n=h;break;case ma:c=ka,h="EnemyDroneDestroyer",i=.05,k*=2,l=~~(.9*l),m+=~~(.1*m),j=!0,n=h;break;default:throw"Unknown enemy type "+c}for(var o=0;o<enemies_data.length;o++){var p=enemies_data[o];if(!p.visible)return p.x=f,p.y=g,p.hp=k,p.EnemyType=c,p.EnemyReel=n,p.sfxExplode=Math.random()>.5?"explode2":"explode1",p.removeComponent("EnemyTurretGreen"),p.removeComponent("EnemyTurretRed"),p.removeComponent("EnemyTurretPurple"),p.removeComponent("EnemyDrone"),p.removeComponent("EnemyDroneAdvanced"),p.removeComponent("EnemyDroneDestroyer"),p.addComponent(h),p.unbind("Kill"),p.unbind("AnimationEnd"),p.unbind("EnterFrame"),p.shootFn,c===ha?(p.w=50,p.h=26,p.sfxFire=Math.random()>.5?"turretshot2":"turretshot1",p.bind("EnterFrame",function(){{var a=this.x+this.w/2;this.y+this.h/2}a<V.cx?(this.flip("X"),this.direction="left"):a>V.cx&&(this.unflip(),this.direction="right")}),p.bind("AnimationEnd",function(a){var b=p.x+p.w/2,c=p.y+p.h/2;"left"===this.direction?b+=24:b-=24,Z(qa,b,c,V.cx,V.cy),ya(L,b,c+8),e(p.sfxFire)}),p.shootFn=function(){var b=this.x+this.w/2,c=this.y+this.h/2;a.math.squaredDistance(b,c,V.cx,V.cy)<m&&this.animate(this.EnemyReel)}.bind(p)):c===ka&&(p.w=50,p.h=50,p.accel=0,p.z=V.z+1,p.sfxFire=Math.random()>.5?"droneshot2":"droneshot1",p.bind("EnterFrame",function(){{var b=this.x+this.w/2;this.y+this.h/2}a.math.withinRange(b,V.cx-2,V.cx+2)?this.accel=0:(b<V.x?(this.accel+=i,this.accel=Math.min(this.accel,6)):(this.accel-=i,this.accel=Math.max(this.accel,-6)),this.x+=this.accel)}),p.animate(n,-1),p.shootFn=function(){if(V.visible){var b=this.x+this.w/2,c=this.y+this.h/2,f=a.math.squaredDistance(b,c,V.cx,V.cy);if(m>f){if(j)for(var g=d(b,c,SPREAD8),h=d(b,c,SPREAD8_R),i=0;i<g.length;i++)Z(ra,g[i][0],g[i][1],h[i][0],h[i][1]);else Z(ra,b,c,V.cx,V.cy);ya(L,b,c+7),e(p.sfxFire)}}}.bind(p)),p.shootDleay=a.e("Delay").delay(p.shootFn,l,-1),p.bind("Kill",function(){switch(this.EnemyType){case ha:ea.turrets+=1;break;case ka:ea.drones+=1;break;default:throw"Unknown enemy type "+c}ya(this.EnemyType===ka?O:N,this.x+this.w/2,this.y+this.h/2),p.shootDleay.cancelDelay(p.shootFn),this.visible=!1,p.unbind("EnterFrame"),e(p.sfxExplode)}),p.visible=!0,p}b("*** No free enemy slots found!")}function Z(c,d,e,f,g,h){for(var i=0;i<bullets_data.length;i++){var j=bullets_data[i];if(!j.visible)return j.ox=d,j.oy=e,j.x=d,j.y=e,h&&(j.speed=h),j.direction=Math.atan2(g-e,f-d),j.unbind("Kill"),j.unbind("HitOn"),j.fn&&j.cancelDelay(j.fn),j.bind("EnterFrame",function(){this.x+=Math.cos(this.direction)*this.speed,this.y+=Math.sin(this.direction)*this.speed,a.math.squaredDistance(this.x,this.y,this.ox,this.oy)>sa&&this.trigger("Kill")}),j.bind("Kill",function(){j.unbind("EnterFrame"),j.ignoreHits(),j.visible=!1}),j.checkHits("Gunner"),j.uniqueBind("HitOn",function(){this.trigger("Kill"),n()}),j.visible=!0,w>x?j.animate("shootGlow",-1):j.animate(c===ra?"shootBlue":"shoot",-1),j}b("*** No free bullet slots found!")}function ya(a,b,c){var d;switch(a){case M:d="Flares";break;case L:d="Flares";break;case N:d="ExplosionsYB";break;case O:d="ExplosionsYB";break;case P:d="ExplosionHit";break;case Q:d="ExplosionHit"}for(var e=0;e<I.length;e++){var f=I[e];if(!f.visible&&f.has(d)){if(f.unbind("EnterFrame"),f.unbind("AnimationEnd"),f.alpha=.9,"undefined"!=typeof b&&(f.x=b-f.w/2,f.y=c-f.h/2),a===M)b=b||0,c=c||0,f.x=V.cx-9+b,f.y=V.cy-9+c,f.bind("EnterFrame",function(){this.x=V.cx-9+b,this.y=V.cy-9+c}),f.animate("player_gunflare");else if(a===L)f.animate("gunflare");else if(a===N)f.animate("explo01");else if(a===O)f.animate("exploBlue");else if(a===P)f.animate("explo02");else{if(a!==Q)throw"wrong anim type - "+a;f.alpha=.75,f.animate("exploHitEnemy")}return f.bind("AnimationEnd",function(){this.visible=!1,this.unbind("EnterFrame")}),void(f.visible=!0)}}}function za(){this.x=a.viewport.width-a.viewport.x-48,this.y=5-a.viewport.y,x=u-~~(.1*(a.viewport.height-V.y)-1),this.text(x+" m.")}function Aa(b){b.mouseButton===a.mouseButtons.LEFT&&(q=!q,a("SFX").image("assets/images/"+(q?"audioOn.png":"audioOff.png")))}function Ba(b){b.mouseButton===a.mouseButtons.LEFT&&(r=!r,a("MUSIC").image("assets/images/"+(r?"musicOn.png":"musicOff.png")),r?a.audio.isPlaying("music1")||f("music1",!0,s):a.audio.isPlaying("music1")&&a.audio.stop("music1"))}i();var Ca=a.e("2D, Canvas, Image, Background").attr({x:-100,y:0,z:-4,w:a.viewport.width+150,h:a.viewport.height}).image("assets/images/wall01.png","repeat"),Da=a.e("2D, Canvas, Image, Background2").attr({x:-100,y:0,z:-4,w:a.viewport.width+150,h:a.viewport.height}).image("assets/images/backgrounds.png","repeat"),Ea=a.e("2D, Canvas, Image, Background").attr({x:-100,y:0,z:-4,w:a.viewport.width+150,h:a.viewport.height}).image("assets/images/starsky.png","repeat"),Fa=a.e("2D, Canvas, BackgroundOverlay, Color, Delay").attr({x:-100,y:0,z:-1,w:a.viewport.width+150,h:a.viewport.height,alpha:.2,direction:"right"}).color("#006064");V=a.e("2D, Canvas, Gunner, SpriteAnimation, Physics, Gravity, Collision, Tween, Delay, Keyboard, Twoway").setName("octocat").attr({x:a.viewport.width/2-50,y:X[0].y,z:990}).origin("center").twoway(_,aa).reel("walk_right",J,0,0,7).reel("walk_left",J,0,1,7).reel("shoot_left",J,0,1,1).reel("shoot_right",J,0,0,1).reel("stand_left",J,[[5,3]]).reel("stand_right",J,[[0,3]]).reel("shoot_n_e",J,2,2,1).reel("shoot_n_w",J,3,2,1).reel("shoot_ne",J,1,2,1).reel("shoot_nw",J,4,2,1).reel("shoot_w_n",J,5,2,1).reel("shoot_e_n",J,0,2,1).reel("shoot_s_e",J,2,3,1).reel("shoot_s_w",J,3,3,1).reel("shoot_se",J,1,3,1).reel("shoot_sw",J,4,3,1).reel("shoot_w_s",J,5,3,1).reel("shoot_e_s",J,0,3,1).animate("stand_left").gravity("Platform").gravityConst(p).collision(12,18,12,47,25,57,38,47,38,18,25,10).onHit("Spikes",j).onHit("Spaceship",k).onHit("HealthRed",l).onHit("EnergyOrange",m).onHit("EnergyBlue",m),o&&V.addComponent("WiredHitBox"),V.bind("CheckLanding",function(a){V.y+V.h>a.y+V.vy&&(V.canLand=!1)}),V.bind("CheckJumping",function(a){!a&&this.hasDoubleJumpPowerUp?(this.canJump=!0,this.hasDoubleJumpPowerUp=!1,e("jumpboost"),Ga.visible=!0,Ga.animate("play")):a&&(this.hasDoubleJumpPowerUp=!0,e("jump"))}),V.bind("LandedOnGround",function(){e("land")}),V.bind("KeyDown",function(b){b.key===a.keys.RIGHT_ARROW||b.key===a.keys.D?this.direction="right":(b.key===a.keys.LEFT_ARROW||b.key===a.keys.A)&&(this.direction="left")}),V.bind("KeyUp",function(b){b.key===a.keys.Z,49===b.key?ba>0&&(ba-=1,a.trigger("playerupdatehealth"),ca+=F,a.trigger("playerupdatejuice"),a.trigger("flashscreen",{clr:"#20ee20",delay:400}),e("overcharge"),e("hurt")):57===b.key?(s+=.1,s=Math.min(s,1)):56===b.key&&(s-=.1,s=Math.max(s,0)),o&&(b.key===a.keys.O&&(ba-=1,a.trigger("playerupdatehealth")),b.key===a.keys.P&&(ba+=1,a.trigger("playerupdatehealth")),b.key===a.keys.K&&y(ha,150+150*Math.random(),100),b.key===a.keys.L&&y(ka,50+150*Math.random(),100))}),V.bind("EnterFrame",function(){if(this.cx=V._x+V.w/2,this.cy=V._y+V.h/2,this.targetEnemy&&(Ha.x=this.targetEnemy.x+this.targetEnemy.w/2-Ha.w/2,Ha.y=this.targetEnemy.y+this.targetEnemy.h/2-Ha.h/2),(this.isDown(a.keys.W)||this.isDown(a.keys.UP_ARROW))&&this.pauseAnimation(),this.isDown(a.keys.LEFT_ARROW)||this.isDown(a.keys.A))this.isPlaying("walk_left")||this.animate("walk_left",10);else if(this.isDown(a.keys.RIGHT_ARROW)||this.isDown(a.keys.D))this.isPlaying("walk_right")||this.animate("walk_right",10);else if(this.isDown(a.keys.Y)||this.isDown(a.keys.Z)||this.isDown(a.keys.X))this.isShooting||(this.isShooting=!0,this.trigger("Shoot"),a.trigger("playerupdatejuice"));else{this.isShooting=!1;var b=this.getReel();b&&"shoot"!==b.id.substr(0,5)&&this.animate("right"===this.direction?"stand_right":"stand_left",0)}}),V.bind("Moved",function(){Ha.visible=!1;for(var b,c,d=9999999,e=null,f=0;f<enemies_data.length;f++){var g=enemies_data[f];if(g.visible){var h=g.x+g.w/2,i=g.y+g.h/2,j=a.math.squaredDistance(h,i,this.cx,this.cy);ga>j&&d>j&&(d=j,b=h,c=i,e=g)}}this.targetEnemy=e,Ha.visible=!!e,this.moved=!0}),V.delay(function(){this.moved||o||(e("wait4mom"),this.animate("shoot_n_e")),this.moved=!1},5e3,-1),V.bind("Shoot",function(){if(ca-=1,V.targetEnemy){var b=V.targetEnemy,c=b.x+b.w/2,d=b.y+b.h/2,f=null,g=Math.atan2(this.cy-d,this.cx-c),h=0,i=0;if(ca>=0)if(b.hp-=da,b.hp<0)b.trigger("Kill"),V.trigger("Moved");else{ya(Q,b.x+b.w*Math.random(),b.y+b.h*Math.random());var j=Math.random();j=j>.7?"rico3":j>.4?"rico2":"rico1",e(j)}a.math.withinRange(g,0,ua)?(f="shoot_w_n",h=-this.w/2+2,i=-this.h/2+10):a.math.withinRange(g,ua,va)?(f="shoot_nw",h=-this.w/2+3,i=-this.h/2+2):a.math.withinRange(g,va,wa)?("left"===this.direction?(f="shoot_n_w",h=4):(f="shoot_n_e",h=-4),i=-this.h/2):a.math.withinRange(g,wa,xa)?(f="shoot_ne",h=this.w/2-6,i=-this.h/2+5):a.math.withinRange(g,xa,ta)?(f="shoot_e_n",h=this.w/2-4,i=-this.h/2+12):a.math.withinRange(g,-ua,0)?(f="shoot_w_s",h=-this.w/2,i=11):a.math.withinRange(g,-va,-ua)?(f="shoot_sw",h=-this.w/2+3,i=this.h/2-9):a.math.withinRange(g,-wa,-va)?("left"===this.direction?(f="shoot_s_w",h=7):(f="shoot_s_e",h=-7),i=this.h/2-4):a.math.withinRange(g,-xa,-wa)?(f="shoot_se",h=this.w/2-5,i=this.h/2-8):a.math.withinRange(g,-ta,-xa)&&(f="shoot_e_s",h=this.w/2-4,i=9),f&&this.animate(f)}else"left"===this.direction?(f="shoot_left",h=-this.w/2):(f="shoot_right",h=this.w/2),i=-2,this.animate(f);if(ca>=0){ya(M,h,i);var j=Math.random();j=j>.7?"gun2":j>.4?"gun3":"gun1",e(j)}else e("gunclip")}),V.delay(function(){ca+=1,a.trigger("playerupdatejuice")},$,-1);var Ga=a.e("2D, Canvas, SpaceshipEngine, SpriteAnimation").attr({x:0,y:0,z:V.z-1,visible:!1}).reel("play",~~(K/2.5),0,0,6).bind("EnterFrame",function(){this.x=V.cx-this.w/2,this.y=V.cy+20}).bind("AnimationEnd",function(){this.visible=!1});V.y=V.y-V.h-1;var Ha=a.e("2D, Canvas, Xhair, Tween").attr({x:0,y:0,z:999,alpha:.75,visible:!1,yoff:0,step:.15}).bind("EnterFrame",function(){this.x+=this.yoff,this.y+=this.yoff,this.yoff+=this.step,this.yoff>5?this.step=-this.step:this.yoff<-5&&(this.step=-this.step)});W=a.e("2D, Canvas, Splatter, SpriteAnimation").origin("center").attr({x:-999,y:0}).reel("play",K,0,0,6),a.e("2D, Canvas, SpriteAnimation, DoorAnim").attr({x:X[0].x,y:X[0].y-54,z:V.z-99}).reel("close",3.5*K,9,0,-10).animate("close");for(var Ia=Math.random()>.5?"Spikes02":"Spikes01",Ja=0;13>Ja;Ja++){var Ka=a.e("2D, Canvas, Spikes, Collision, "+Ia).attr({x:-150+50*Ja,y:a.viewport.height-23,w:50,h:23});o&&Ka.addComponent("WiredHitBox")}a.bind("EnterFrame",c),a.uniqueBind("Pause",function(){a.audio.mute(),a("BackgroundOverlay").color("#000000"),a("BackgroundOverlay").alpha=.5,a("PauseText").destroy(),a.e("2D, DOM, Text, SpaceFont, PauseText").attr({x:V.x-15,y:V.y-25,w:a.viewport.width}).textFont({size:"16px"}).textColor("white").text("Paused")}),a.uniqueBind("Unpause",function(){a.audio.unmute(),a("BackgroundOverlay").color("#006064"),a("BackgroundOverlay").alpha=.2,a("PauseText").destroy()}),a.uniqueBind("flashscreen",function(b){if(b){var c=a("BackgroundOverlay");c.color(b.clr).delay(function(){this.color("#006064")},b.delay)}}),a.uniqueBind("playerdead",function(){fa||(fa=!0,e("deathsplat"),e("death"),W.x=V.cx-40,W.y=V.cy-22,W.animate("play"),W.one("AnimationEnd",function(){this.destroy()}),V.visible=!1,V.destroy(),a.e("Delay").delay(function(){a.scene("dead",{meters:x,kills:ea})},1150,0))}),a.uniqueBind("playerwin",function(){V.x=-1e3,V.visible=!1,V.destroy(),T.destroy(),S.destroy(),R.bind("EnterFrame",function(){this._acc+=.0125,this._acc=Math.min(this._acc,5),this.y-=this._acc}),a.viewport.follow(R,0,0);a.e("2D, Canvas, SpaceshipEngine, SpriteAnimation").attr({x:R.x+41,y:R.y+80,z:-3}).reel("play2",1500,3,0,3).reel("play",1500,0,0,6).animate("play").bind("EnterFrame",function(){this.x=R.x+41,this.y=R.y+78}).bind("AnimationEnd",function(a){this.animate("play2",-1)}),a.e("2D, Canvas, SpaceshipEngine, SpriteAnimation").attr({x:R.x+28,y:R.y+80,z:-3}).reel("play2",1500,3,0,3).reel("play",1500,0,0,6).animate("play").bind("EnterFrame",function(){this.x=R.x+28,this.y=R.y+78}).bind("AnimationEnd",function(a){this.animate("play2",-1)});e("liftoff"),e("liftoff2"),a.e("Delay").delay(function(){e("movin")},1e3,0),a.e("Delay").delay(function(){a.e("2D, DOM, Text, SpaceFont").attr({x:125,y:150,w:a.viewport.width}).textFont({size:"20px"}).textColor("white").text("Mission Successful!").bind("EnterFrame",function(){this.y=R.y-100})},5e3,0),a.e("Delay").delay(function(){a.e("2D, DOM, Text, SpaceFont").attr({x:115,y:150,w:a.viewport.width}).textFont({size:"20px"}).textColor("white").text("Good job agent Strider!").bind("EnterFrame",function(){this.y=R.y+150})},8e3,0),a.e("Keyboard").bind("KeyDown",function(b){(b.keyCode===a.keys.ESC||b.keyCode===a.keys.ENTER||b.keyCode===a.keys.SPACE)&&(this.destroy(),a.scene("dead",{success:!0,meters:x,kills:ea}))})}),a.uniqueBind("playerupdatehealth",function(){if(T){switch(ba=ba>G?G:ba,ba=0>ba?0:ba,T.removeComponent("HUDHealth4").removeComponent("HUDHealth3").removeComponent("HUDHealth2").removeComponent("HUDHealth1").removeComponent("HUDHealth0"),ba){case 4:T.addComponent("HUDHealth4");break;case 3:T.addComponent("HUDHealth3");break;case 2:T.addComponent("HUDHealth2");break;case 1:T.addComponent("HUDHealth1");break;default:T.addComponent("HUDHealth0")}T.trigger("NewComponent")}}),a.uniqueBind("playerupdatejuice",function(){S&&(ca=0>ca?0:ca,ca=ca>F?F:ca,S.trigger("Invalidate"))}),a.uniqueBind("playsmokeanim",function(a){U.x=V.x,U.y=V.y,U.visible=!0,U.animate("smoke")}),function(){var b,c;for(b=0;z>b;b++)c=a.e("2D, Canvas, Powerup, Collision").attr({x:0,y:0,z:889,visible:!1,type:""}).collision(),Y.push(c);for(b=0;A>b;b++)c=a.e("2D, Canvas, Enemy, SpriteAnimation, Delay").attr({x:0,y:0,z:890,visible:!1}).origin("center").reel("EnemyTurretGreen",K,0,0,2).reel("EnemyTurretRed",K,0,1,2).reel("EnemyTurretPurple",K,0,2,2).reel("EnemyDrone",K,2,1,2).reel("EnemyDroneAdvanced",K,0,0,2).reel("EnemyDroneDestroyer",K,0,1,2),enemies_data.push(c);for(b=0;B>b;b++)c=a.e("2D, Canvas, EnemyBullet, Collision, SpriteAnimation, Delay").attr({x:0,y:0,z:892,visible:!1,direction:0,speed:BULLET_SPEED,hp:0}).reel("shoot",K,0,0,2).reel("shootBlue",K,0,1,2).reel("shootGlow",K,0,2,2),bullets_data.push(c);for(b=0;H/3>b;b++)c=a.e("2D, Canvas, SpriteAnimation, Flares").attr({x:0,y:0,z:991,visible:!1,alpha:.9}).reel("player_gunflare",K/2,[[2,0],[1,0],[0,0],[3,1],[1,0],[0,0]]).reel("gunflare",K/2,[[2,0],[1,0],[0,0],[3,1],[1,0],[0,0]]).origin("center"),I.push(c),c=a.e("2D, Canvas, SpriteAnimation, ExplosionsYB").attr({x:0,y:0,z:991,visible:!1,alpha:.9}).reel("explo01",K,0,0,6).reel("exploBlue",K,0,1,6).origin("center").animate("explo01"),I.push(c),c=a.e("2D, Canvas, SpriteAnimation, ExplosionHit").attr({x:0,y:0,z:991,visible:!1,alpha:.9}).reel("explo02",K,0,0,6).reel("exploHitEnemy",K/2,0,0,6).origin("center"),I.push(c)}(),function(){for(var b=0;b<X.length;b++){var c=X[b],d=a.e("2D, Canvas, Color, Platform, Collision, Tween, Delay, "+c.clr).attr(c).collision();d.alpha=1,d.collision();{~~(10*(1+Math.random()))}c.goal&&!R&&(R=a.e("2D, Canvas, Spaceship, Collision, SpriteAnimation").attr({x:c.x+50,y:c.y-86,z:-3,_acc:.125}).collision());var e=g(d.y);if(c.powerup&&!c.powerupAdded&&(h(c.powerup,d.x+Math.random()*(d.w-20),d.y),c.powerupAdded=!0),c.hasTurret&&!c.turretAdded){if(spawnX=d.x+Math.random()*(d.w-50),w>e)y(ja,spawnX,d.y-26),h(E,spawnX+12,d.y);else if(v>e)y(ia,spawnX,d.y-26),h(E,spawnX+12,d.y);else{y(ha,spawnX,d.y-26);var f=Math.random();.25>f?h(c.powerup,spawnX+12,d.y):.5>f&&h(E,spawnX+12,d.y)}c.turretAdded=!0}c.hasDrone&&!c.droneAdded&&(spawnX=d.x+Math.random()*(d.w-50),w>e?y(ma,spawnX,d.y-50):v>e?y(la,spawnX,d.y-50):v+100>e?y(ma,spawnX,d.y-50):2e3>e?y(la,spawnX,d.y-50):y(ka,spawnX,d.y-50),
c.droneAdded=!0)}}(),U=a.e("2D, Canvas, SmokeJump, SpriteAnimation").origin("center").attr({x:this.x+16,y:this.y-8,w:64,h:64,visible:!1}).reel("smoke",K,0,0,10).bind("AnimationEnd",function(){this.visible=!1}),a.e("2D, DOM, Text").attr({x:5,w:50,z:9999}).css({color:"#fff",textShadow:"0px 2px 4px rgba(0,0,0,.5)"}).bind("EnterFrame",za),T=a.e("2D, Canvas, HUDHealth4").attr({x:5,z:9999}).bind("InvalidateViewport",function(){this.x=5-a.viewport.x,this.y=~~(2-a.viewport.y)}),S=a.e("2D, Canvas, HUDEnergy").attr({x:75,z:9999}).bind("InvalidateViewport",function(){this.x=75-a.viewport.x,this.y=~~(2-a.viewport.y)}).bind("Draw",function(a){var b=a.ctx,c=19+F-(F-ca);b.beginPath(),b.rect(a.pos._x+c,a.pos._y+4,F-ca,11),b.fillStyle="black",b.fill()}),a.e("2D, DOM, SFX, Image, Mouse").attr({x:a.viewport.width-52,y:-a.viewport.y+10,w:48,h:48,z:9999}).css("cursor","pointer").image("assets/images/audioOn.png").bind("InvalidateViewport",function(){this.x=a.viewport.width-a.viewport.x-52,this.y=a.viewport.height-50-a.viewport.y}).bind("MouseOver",function(){this.alpha=.8,this.bind("MouseDown",Aa)}).bind("MouseOut",function(){this.alpha=1,this.unbind("MouseDown",Aa)}),a.e("2D, DOM, MUSIC, Image, Mouse").attr({x:a.viewport.width-94,y:-a.viewport.y+10,w:48,h:48,z:9999}).css("cursor","pointer").image("assets/images/musicOn.png").bind("InvalidateViewport",function(){this.x=a.viewport.width-a.viewport.x-96,this.y=a.viewport.height-50-a.viewport.y}).bind("MouseOver",function(){this.alpha=.8,this.bind("MouseDown",Ba)}).bind("MouseOut",function(){this.alpha=1,this.unbind("MouseDown",Ba)}),a.viewport.follow(V,0,0),t&&(e("warning"),e("doorshut")),f("music1",!0,s)}),a.scene("loading")})}(Crafty);